'use strict';
const { PerformanceObserver, performance } = require('perf_hooks');
var fs = require("fs");
const assert = require('assert');



const https = require('https');
var fs = require("fs");
var myParser = require("body-parser");
var qs = require('querystring');
const { exec } = require('child_process');
var nunjucks = require('nunjucks');
var crypto = require("crypto");
var Papa = require('papaparse');

const options = {
  key: fs.readFileSync('/etc/letsencrypt/live/inlinemath.com/privkey.pem'),
  cert: fs.readFileSync('/etc/letsencrypt/live/inlinemath.com/fullchain.pem')
};





var express = require('express');
var app = express();
app.use('/',express.static('static'));
app.use(myParser.urlencoded({ extended: true }));
app.use(myParser.json());
app.use(myParser.raw());

const server1 = https.createServer(options, app);

server1.listen(12312);

const server = https.createServer(options, (req, res) => {
  res.writeHead(200);
  res.end('\n');
}).listen(8081);

const WebSocket = require('ws');
//const wss = new WebSocket.Server({ port: 8080 , origin: 'http://tabdn.com'});
const wss = new WebSocket.Server({ server });
wss.on('connection', function connection(ws) {
	var username = '';
  	ws.on('message', function incoming(message) {
  		console.log(performance.now());
		var dm = JSON.parse(message);
		console.log(performance.now());
		if (dm.operation == 'key'){
			if (tempKeys[dm.message]){
				username = tempKeys[dm.message].username;
			}
		}
		
		
		
  	});
});

var startTime = performance.now();


//load all data into memory
var csvdata = {};
csvdata['convert']={'states':{},'cds':{},'counties':{},'evd':{}}
csvdata['states']={}
csvdata['cds']={}
csvdata['counties']={}
csvdata['evd']={}

function loadAllData() {
	var econPred16 = Papa.parse("predictions16.csv", {
		delimiter: ",",
		skipEmptyLines: false,
		quoteChar: '"',
	});
	console.log(econPred16);
	for (var i=1;i<econPred16.length;i++){
		csvdata['states'][econPred16[i][0]]={};
		csvdata['states'][econPred16[i][0]]['econPreddwin16']=parseFloat(econPred16[i][4]);
	}
}

loadAllData();
console.log(csvdata['states']);

app.get(['/predict','/predict.html'],
	function(req, res){
		
		
		res.write(nunjucks.render('templates/datatable.html',{

		}));
		res.end();
	}
);

app.get(['/electoral','/electoral.html'],
	function(req, res){
		
		
		res.write(nunjucks.render('templates/electoraltable.html',{

		}));
		res.end();
	}
);

app.get(['/senate','/senate.html'],
	function(req, res){
		
		
		res.write(nunjucks.render('templates/senatetable.html',{

		}));
		res.end();
	}
);

app.get(['/house','/house.html'],
	function(req, res){
		
		
		res.write(nunjucks.render('templates/house.html',{

		}));
		res.end();
	}
);

app.get(['/map','/map.html'],
	function(req, res){
		
		var eData = [{'abbrev': 'dc', 'votes16': 295553, 'ev10': 3, 'pres08': 0.06599232, 'pres12': 0.07412351, 'rperc': 0.04304812}, {'abbrev': 'hi', 'votes16': 395738, 'ev10': 4, 'pres08': 0.27006274, 'pres12': 0.28296151, 'rperc': 0.32558663}, {'abbrev': 'ca', 'votes16': 13237598, 'ev10': 55, 'pres08': 0.3772155, 'pres12': 0.38127189, 'rperc': 0.33871779}, {'abbrev': 'vt', 'votes16': 273942, 'ev10': 3, 'pres08': 0.31100818, 'pres12': 0.31752741, 'rperc': 0.34813574}, {'abbrev': 'ma', 'votes16': 3086089, 'ev10': 11, 'pres08': 0.36802922, 'pres12': 0.38214319, 'rperc': 0.35348721}, {'abbrev': 'md', 'votes16': 2621097, 'ev10': 10, 'pres08': 0.37069913, 'pres12': 0.36678274, 'rperc': 0.3598375}, {'abbrev': 'ny', 'votes16': 6906931, 'ev10': 29, 'pres08': 0.34236143, 'pres12': 0.33957305, 'rperc': 0.36588494}, {'abbrev': 'il', 'votes16': 5236744, 'ev10': 20, 'pres08': 0.37265736, 'pres12': 0.41422477, 'rperc': 0.40979949}, {'abbrev': 'wa', 'votes16': 2964465, 'ev10': 12, 'pres08': 0.41247973, 'pres12': 0.42371702, 'rperc': 0.41213069}, {'abbrev': 'ri', 'votes16': 433068, 'ev10': 4, 'pres08': 0.35801862, 'pres12': 0.35983254, 'rperc': 0.41689296}, {'abbrev': 'nj', 'votes16': 3750211, 'ev10': 14, 'pres08': 0.4213537, 'pres12': 0.41048034, 'rperc': 0.4271581}, {'abbrev': 'ct', 'votes16': 1570787, 'ev10': 7, 'pres08': 0.38681662, 'pres12': 0.41227423, 'rperc': 0.42858452}, {'abbrev': 'or', 'votes16': 1784509, 'ev10': 7, 'pres08': 0.41586279, 'pres12': 0.43728833, 'rperc': 0.43844161}, {'abbrev': 'de', 'votes16': 420730, 'ev10': 3, 'pres08': 0.37361861, 'pres12': 0.40553045, 'rperc': 0.44001379}, {'abbrev': 'nm', 'votes16': 704901, 'ev10': 5, 'pres08': 0.423351, 'pres12': 0.44704795, 'rperc': 0.45349205}, {'abbrev': 'va', 'votes16': 3750916, 'ev10': 13, 'pres08': 0.46817416, 'pres12': 0.48032623, 'rperc': 0.47173624}, {'abbrev': 'co', 'votes16': 2541354, 'ev10': 9, 'pres08': 0.45449365, 'pres12': 0.47252012, 'rperc': 0.47316667}, {'abbrev': 'me', 'votes16': 693328, 'ev10': 4, 'pres08': 0.41170475, 'pres12': 0.42140079, 'rperc': 0.48403209}, {'abbrev': 'nv', 'votes16': 1051318, 'ev10': 6, 'pres08': 0.43613262, 'pres12': 0.46592458, 'rperc': 0.48706291}, {'abbrev': 'mn', 'votes16': 2690654, 'ev10': 10, 'pres08': 0.44770625, 'pres12': 0.46058774, 'rperc': 0.49168306}, {'abbrev': 'nh', 'votes16': 694316, 'ev10': 4, 'pres08': 0.45131459, 'pres12': 0.47166248, 'rperc': 0.49802972}, {'abbrev': 'mi', 'votes16': 4548382, 'ev10': 16, 'pres08': 0.41628698, 'pres12': 0.45199468, 'rperc': 0.50117668}, {'abbrev': 'pa', 'votes16': 5897174, 'ev10': 20, 'pres08': 0.44770296, 'pres12': 0.47268066, 'rperc': 0.50375536}, {'abbrev': 'wi', 'votes16': 2787820, 'ev10': 10, 'pres08': 0.42944322, 'pres12': 0.4653657, 'rperc': 0.50407989}, {'abbrev': 'fl', 'votes16': 9122861, 'ev10': 29, 'pres08': 0.4858034, 'pres12': 0.49557748, 'rperc': 0.50618835}, {'abbrev': 'az', 'votes16': 2413568, 'ev10': 11, 'pres08': 0.54313901, 'pres12': 0.5461338, 'rperc': 0.51890023}, {'abbrev': 'nc', 'votes16': 4551947, 'ev10': 15, 'pres08': 0.49834037, 'pres12': 0.51034035, 'rperc': 0.51903746}, {'abbrev': 'ga', 'votes16': 3967067, 'ev10': 16, 'pres08': 0.52628336, 'pres12': 0.53956649, 'rperc': 0.52661173}, {'abbrev': 'oh', 'votes16': 5235169, 'ev10': 18, 'pres08': 0.47666159, 'pres12': 0.48485943, 'rperc': 0.54267685}, {'abbrev': 'tx', 'votes16': 8562915, 'ev10': 38, 'pres08': 0.55935937, 'pres12': 0.58007897, 'rperc': 0.54713226}, {'abbrev': 'ia', 'votes16': 1454652, 'ev10': 6, 'pres08': 0.45151222, 'pres12': 0.47040648, 'rperc': 0.55063548}, {'abbrev': 'sc', 'votes16': 2010762, 'ev10': 9, 'pres08': 0.54544429, 'pres12': 0.55308255, 'rperc': 0.57460256}, {'abbrev': 'ak', 'votes16': 279841, 'ev10': 3, 'pres08': 0.61064785, 'pres12': 0.5731529, 'rperc': 0.58385655}, {'abbrev': 'ms', 'votes16': 1185845, 'ev10': 6, 'pres08': 0.56641931, 'pres12': 0.55801899, 'rperc': 0.59089847}, {'abbrev': 'mo', 'votes16': 2665579, 'ev10': 10, 'pres08': 0.50067579, 'pres12': 0.54778667, 'rperc': 0.59818561}, {'abbrev': 'in', 'votes16': 2590412, 'ev10': 11, 'pres08': 0.49478047, 'pres12': 0.55200375, 'rperc': 0.6011731}, {'abbrev': 'la', 'votes16': 1958792, 'ev10': 8, 'pres08': 0.59457174, 'pres12': 0.58746826, 'rperc': 0.60171677}, {'abbrev': 'mt', 'votes16': 456949, 'ev10': 3, 'pres08': 0.51169403, 'pres12': 0.57034232, 'rperc': 0.61109664}, {'abbrev': 'ks', 'votes16': 1098023, 'ev10': 6, 'pres08': 0.57612276, 'pres12': 0.61113327, 'rperc': 0.6111147}, {'abbrev': 'ut', 'votes16': 825885, 'ev10': 6, 'pres08': 0.64526361, 'pres12': 0.74626189, 'rperc': 0.62382898}, {'abbrev': 'ne', 'votes16': 780455, 'ev10': 5, 'pres08': 0.57609074, 'pres12': 0.6112939, 'rperc': 0.63547674}, {'abbrev': 'tn', 'votes16': 2393620, 'ev10': 11, 'pres08': 0.57631472, 'pres12': 0.60351072, 'rperc': 0.63624343}, {'abbrev': 'ar', 'votes16': 1065366, 'ev10': 6, 'pres08': 0.60171721, 'pres12': 0.62154405, 'rperc': 0.64285138}, {'abbrev': 'al', 'votes16': 2047802, 'ev10': 9, 'pres08': 0.60890903, 'pres12': 0.61216229, 'rperc': 0.64374144}, {'abbrev': 'ky', 'votes16': 1831825, 'ev10': 8, 'pres08': 0.58233428, 'pres12': 0.61542772, 'rperc': 0.65670629}, {'abbrev': 'sd', 'votes16': 345179, 'ev10': 3, 'pres08': 0.54295707, 'pres12': 0.59218499, 'rperc': 0.65971858}, {'abbrev': 'id', 'votes16': 598820, 'ev10': 4, 'pres08': 0.6302459, 'pres12': 0.66421387, 'rperc': 0.68310177}, {'abbrev': 'ok', 'votes16': 1369511, 'ev10': 7, 'pres08': 0.65645081, 'pres12': 0.6677232, 'rperc': 0.69304737}, {'abbrev': 'nd', 'votes16': 310552, 'ev10': 3, 'pres08': 0.54408656, 'pres12': 0.60111208, 'rperc': 0.69809243}, {'abbrev': 'wv', 'votes16': 678165, 'ev10': 5, 'pres08': 0.56673744, 'pres12': 0.63674298, 'rperc': 0.72161052}, {'abbrev': 'wy', 'votes16': 230392, 'ev10': 3, 'pres08': 0.66562023, 'pres12': 0.71160634, 'rperc': 0.7570532}];
		for (var i=0;i<eData.length;i++){
			eData[i].rpred = eData[i].rperc;
			//eData[i].rpred = eData[i].pres08;
			eData[i].pres16 = eData[i].rperc;
			delete eData[i].rperc;
		}
		res.write(nunjucks.render('templates/map.html',{
			electoralData: eData,

		}));
		res.end();
	}
);

app.get(['/housemap','/housemap.html'],
	function(req, res){
		
		
		res.write(nunjucks.render('templates/housedata.html',{
			//electoralData: eData,

		}));
		res.end();
	}
);

app.get(['/carving','/carving.html'],
	function(req, res){
		
		
		res.write(nunjucks.render('templates/carving.html',{
			//electoralData: eData,

		}));
		res.end();
	}
);


app.post(['/housemap','/housemap.html'],
	function(req, res){
		console.log(req.body);
		
		res.write(nunjucks.render('templates/housedata.html',{
			//electoralData: eData,
			districts: false,
			

		}));
		res.end();
	}
);

app.post(['/senatemap','/senatemap.html'],
	function(req, res){
		var userData16 = {};
		var userData20 = {};
		for (var i in req.body){
			if (req.body[i] != ''){
				var p = parseFloat(req.body[i]);
				var state = i.split('-');
				if (state.length > 4){
					continue;
				}
				if (state[1]=="2016"){
					userData16[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				else if (state[1]=="2020"){
					userData20[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				
			}
		}
		for (var i in req.body){
			if (req.body[i] != ''){
				var p = parseFloat(req.body[i]);
				var state = i.split('-');
				if (state.length > 3){
					continue;
				}
				if (state[1]=="2016"){
					userData16[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				else if (state[1]=="2020"){
					userData20[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				
			}
		}
		for (var i in req.body){
			if (req.body[i] != ''){
				var p = parseFloat(req.body[i]);
				var state = i.split('-');
				if (state[1]=="2016" && state.length>4){
					userData16[state[0].toLowerCase()]["pres20"]=p;
				}
				else if (state[1]=="2020" && state.length>4){
					userData20[state[0].toLowerCase()]["pres20"]=p;
				}
				else if (state[1]=="2016" && state.length>3){
					userData16[state[0].toLowerCase()]["sen20"]=p;
				}
				else if (state[1]=="2020" && state.length>3){
					userData20[state[0].toLowerCase()]["sen20"]=p;
				}
				
			}
		}
		var eData = {'al': {'pres08': 0.60890903, 'pres12': 0.61216229, 'pres16': 0.64374144, 2006: [], 2008: [0.63436655], 2010: [0.65250101], 2012: [], 2014: [1.0], 2016: [0.6407024], 2018: [0.48]}, 'ak': {'pres08': 0.61064785, 'pres12': 0.5731529, 'pres16': 0.58385655, 2006: [], 2008: [0.49340245], 2010: [0.60204528], 2012: [], 2014: [0.51135248], 2016: [0.79237048], 2018: []}, 'az': {'pres08': 0.54313901, 'pres12': 0.5461338, 'pres16': 0.51890023, 2006: [0.55081266], 2008: [], 2010: [0.62944331], 2012: [0.51586059], 2014: [.5686], 2016: [0.56860915], 2018: [0.49]}, 'ar': {'pres08': 0.60171721, 'pres12': 0.62154405, 'pres16': 0.64285138, 2006: [], 2008: [0.0], 2010: [0.61048104], 2012: [], 2014: [0.58895833], 2016: [0.62299334], 2018: []}, 'ca': {'pres08': 0.3772155, 'pres12': 0.38127189, 'pres16': 0.33871779, 2006: [0.37074264], 2008: [], 2010: [0.4469534], 2012: [0.37475716], 2014: [], 2016: [0.0], 2018: [0.0]}, 'co': {'pres08': 0.45449365, 'pres12': 0.47252012, 'pres16': 0.47316667, 2006: [], 2008: [0.44593471], 2010: [0.49138188], 2012: [], 2014: [0.51029203], 2016: [0.46995547], 2018: []}, 'ct': {'pres08': 0.38681662, 'pres12': 0.41227423, 'pres16': 0.42858452, 2006: [0.1949818], 2008: [], 2010: [0.45158195], 2012: [0.43259142], 2014: [], 2016: [0.37506846], 2018: [0.42]}, 'de': {'pres08': 0.37361861, 'pres12': 0.40553045, 'pres16': 0.44001379, 2006: [0.29019438], 2008: [0.35313487], 2010: [0.41422921], 2012: [0.30358291], 2014: [0.43064259], 2016: [], 2018: [0.4]}, 'dc': {'pres08': 0.06599232, 'pres12': 0.07412351, 'pres16': 0.04304812, 2006: [], 2008: [], 2010: [], 2012: [], 2014: [], 2016: [], 2018: []}, 'fl': {'pres08': 0.4858034, 'pres12': 0.49557748, 'pres16': 0.50618835, 2006: [0.38716405], 2008: [], 2010: [0.70766787], 2012: [0.43327351], 2014: [], 2016: [0.53980578], 2018: [0.51]}, 'ga': {'pres08': 0.52628336, 'pres12': 0.53956649, 'pres16': 0.52661173, 2006: [], 2008: [0.31525622], 2010: [0.59921654], 2012: [], 2014: [0.53915937], 2016: [0.57175417], 2018: []}, 'hi': {'pres08': 0.27006274, 'pres12': 0.28296151, 'pres16': 0.32558663, 2006: [0.37481237], 2008: [], 2010: [0.22381407], 2012: [0.37398457], 2014: [0.28421294], 2016: [0.23206356], 2018: [0.28]}, 'id': {'pres08': 0.6302459, 'pres12': 0.66421387, 'pres16': 0.68310177, 2006: [], 2008: [0.6283206], 2010: [0.7406148], 2012: [], 2014: [0.65328362], 2016: [0.70459902], 2018: []}, 'il': {'pres08': 0.37265736, 'pres12': 0.41422477, 'pres16': 0.40979949, 2006: [], 2008: [0.29604426], 2010: [0.50846441], 2012: [], 2014: [0.44361346], 2016: [0.42032449], 2018: []}, 'in': {'pres08': 0.49478047, 'pres12': 0.55200375, 'pres16': 0.6011731, 2006: [1.0], 2008: [], 2010: [0.57707812], 2012: [0.46944677], 2014: [], 2016: [0.55130669], 2018: [0.53]}, 'ia': {'pres08': 0.45151222, 'pres12': 0.47040648, 'pres16': 0.55063548, 2006: [], 2008: [0.3729219], 2010: [0.6589727], 2012: [], 2014: [0.54349482], 2016: [0.62760265], 2018: []}, 'ks': {'pres08': 0.57612276, 'pres12': 0.61113327, 'pres16': 0.6111147, 2006: [], 2008: [0.62225807], 2010: [0.72657045], 2012: [], 2014: [1.0], 2016: [0.65854281], 2018: []}, 'ky': {'pres08': 0.58233428, 'pres12': 0.61542772, 'pres16': 0.65670629, 2006: [], 2008: [0.5296562], 2010: [0.55740479], 2012: [], 2014: [0.57980287], 2016: [0.57274552], 2018: []}, 'la': {'pres08': 0.59457174, 'pres12': 0.58746826, 'pres16': 0.60171677, 2006: [], 2008: [0.46736119], 2010: [0.60018691], 2012: [], 2014: [0.52308918], 2016: [0.6065461], 2018: []}, 'me': {'pres08': 0.41170475, 'pres12': 0.42140079, 'pres16': 0.48403209, 2006: [0.78190647], 2008: [0.61383512], 2010: [], 2012: [0.36758826], 2014: [0.6848842], 2016: [], 2018: [0.46]}, 'md': {'pres08': 0.37069913, 'pres12': 0.36678274, 'pres16': 0.3598375, 2006: [0.44913586], 2008: [], 2010: [0.36503012], 2012: [0.31988415], 2014: [], 2016: [0.36944741], 2018: [0.36]}, 'ma': {'pres08': 0.36802922, 'pres12': 0.38214319, 'pres16': 0.35348721, 2006: [0.30594329], 2008: [0.31954391], 2010: [], 2012: [0.46222761], 2014: [0.38039881], 2016: [], 2018: [0.4]}, 'mi': {'pres08': 0.41628698, 'pres12': 0.45199468, 'pres16': 0.50117668, 2006: [0.42027743], 2008: [0.35069675], 2010: [], 2012: [0.39247231], 2014: [0.43076489], 2016: [], 2018: [0.47]}, 'mn': {'pres08': 0.44770625, 'pres12': 0.46058774, 'pres16': 0.49168306, 2006: [0.39520086], 2008: [0.49993567], 2010: [], 2012: [0.31880698], 2014: [0.44668105], 2016: [], 2018: [0.39, 0.46]}, 'ms': {'pres08': 0.56641931, 'pres12': 0.55801899, 'pres16': 0.59089847, 2006: [0.64582582], 2008: [0.61435046, 1.0], 2010: [], 2012: [0.58497246], 2014: [0.61250809], 2016: [], 2018: [0.54, 0.59]}, 'mo': {'pres08': 0.50067579, 'pres12': 0.54778667, 'pres16': 0.59818561, 2006: [0.48828579], 2008: [], 2010: [0.57170253], 2012: [0.41642216], 2014: [], 2016: [0.51460769], 2018: [0.52]}, 'mt': {'pres08': 0.51169403, 'pres12': 0.57034232, 'pres16': 0.61109664, 2006: [0.49550398], 2008: [0.27084022], 2010: [], 2012: [0.48010454], 2014: [0.5905309], 2016: [], 2018: [0.49]}, 'ne': {'pres08': 0.57609074, 'pres12': 0.6112939, 'pres16': 0.63547674, 2006: [0.36117208], 2008: [0.58948417], 2010: [], 2012: [0.57774433], 2014: [0.67141916], 2016: [], 2018: [0.58]}, 'nv': {'pres08': 0.43613262, 'pres12': 0.46592458, 'pres16': 0.48706291, 2006: [0.57456391], 2008: [], 2010: [0.46972576], 2012: [0.50640453], 2014: [], 2016: [0.4867684], 2018: [0.48]}, 'nh': {'pres08': 0.45131459, 'pres12': 0.47166248, 'pres16': 0.49802972, 2006: [], 2008: [0.46727682], 2010: [0.61987508], 2012: [], 2014: [0.48372457], 2016: [0.49928206], 2018: []}, 'nj': {'pres08': 0.4213537, 'pres12': 0.41048034, 'pres16': 0.4271581, 2006: [0.45381917], 2008: [0.42817144], 2010: [], 2012: [0.40079838], 2014: [0.43118622], 2016: [], 2018: [0.46]}, 'nm': {'pres08': 0.423351, 'pres12': 0.44704795, 'pres16': 0.45349205, 2006: [0.0009095], 2008: [0.38672009], 2010: [], 2012: [0.47024206], 2014: [0.4444119], 2016: [], 2018: [0.46]}, 'ny': {'pres08': 0.34236143, 'pres12': 0.33957305, 'pres16': 0.36588494, 2006: [0.31005976], 2008: [], 2010: [0.28912171, 0.32047667], 2012: [0.25521923], 2014: [], 2016: [0.26488753], 2018: [0.33]}, 'nc': {'pres08': 0.49834037, 'pres12': 0.51034035, 'pres16': 0.51903746, 2006: [], 2008: [0.45627065], 2010: [0.56011479], 2012: [], 2014: [0.50814164], 2016: [0.5295356], 2018: []}, 'nd': {'pres08': 0.54408656, 'pres12': 0.60111208, 'pres16': 0.69809243, 2006: [0.30022418], 2008: [], 2010: [0.77431769], 2012: [0.49540874], 2014: [], 2016: [0.82222304], 2018: [0.55]}, 'oh': {'pres08': 0.47666159, 'pres12': 0.48485943, 'pres16': 0.54267685, 2006: [0.43824268], 2008: [], 2010: [0.59060974], 2012: [0.46855014], 2014: [], 2016: [0.6096339], 2018: [0.47]}, 'ok': {'pres08': 0.65645081, 'pres12': 0.6677232, 'pres16': 0.69304737, 2006: [], 2008: [0.59125435], 2010: [0.72994506], 2012: [], 2014: [0.70433441, 0.70069755], 2016: [0.73375957], 2018: []}, 'or': {'pres08': 0.41586279, 'pres12': 0.43728833, 'pres16': 0.43844161, 2006: [], 2008: [0.4822608], 2010: [0.40683808], 2012: [], 2014: [0.3981479], 2016: [0.37074179], 2018: []}, 'pa': {'pres08': 0.44770296, 'pres12': 0.47268066, 'pres16': 0.50375536, 2006: [0.41316242], 2008: [], 2010: [0.51008495], 2012: [0.45369023], 2014: [], 2016: [0.5074518], 2018: [0.44]}, 'ri': {'pres08': 0.35801862, 'pres12': 0.35983254, 'pres16': 0.41689296, 2006: [0.46481365], 2008: [0.26595516], 2010: [], 2012: [0.35043714], 2014: [0.29297096], 2016: [], 2018: [0.38]}, 'sc': {'pres08': 0.54544429, 'pres12': 0.55308255, 'pres16': 0.57460256, 2006: [], 2008: [0.57656381], 2010: [0.68980125], 2012: [], 2014: [0.59569856, 0.62230132], 2016: [0.6379825], 2018: []}, 'sd': {'pres08': 0.54295707, 'pres12': 0.59218499, 'pres16': 0.65971858, 2006: [], 2008: [0.37508308], 2010: [1.0], 2012: [], 2014: [0.63056851], 2016: [0.71827862], 2018: []}, 'tn': {'pres08': 0.57631472, 'pres12': 0.60351072, 'pres16': 0.63624343, 2006: [0.51379506], 2008: [0.6730593], 2010: [], 2012: [0.68093205], 2014: [0.66003874], 2016: [], 2018: [0.54]}, 'tx': {'pres08': 0.55935937, 'pres12': 0.58007897, 'pres16': 0.54713226, 2006: [0.63120576], 2008: [0.56135139], 2010: [], 2012: [0.58154549], 2014: [0.64175457], 2016: [], 2018: [0.51]}, 'ut': {'pres08': 0.64526361, 'pres12': 0.74626189, 'pres16': 0.62382898, 2006: [0.6674911], 2008: [], 2010: [0.65274435], 2012: [0.68537887], 2014: [], 2016: [0.71578547], 2018: [0.63]}, 'vt': {'pres08': 0.31100818, 'pres12': 0.31752741, 'pres16': 0.34813574, 2006: [0.33100771], 2008: [], 2010: [0.32457809], 2012: [0.2596582], 2014: [], 2016: [0.350267], 2018: [0.3]}, 'va': {'pres08': 0.46817416, 'pres12': 0.48032623, 'pres16': 0.47173624, 2006: [0.49800823], 2008: [0.3415165], 2010: [], 2012: [0.47042306], 2014: [0.49583796], 2016: [], 2018: [0.43]}, 'wa': {'pres08': 0.41247973, 'pres12': 0.42371702, 'pres16': 0.41213069, 2006: [0.41259443], 2008: [], 2010: [0.47635174], 2012: [0.39549009], 2014: [], 2016: [0.4098699], 2018: [0.4]}, 'wv': {'pres08': 0.56673744, 'pres12': 0.63674298, 'pres16': 0.72161052, 2006: [0.22950978], 2008: [0.36262174], 2010: [0.4480444], 2012: [0.37582743], 2014: [0.64316035], 2016: [], 2018: [0.48]}, 'wi': {'pres08': 0.42944322, 'pres12': 0.4653657, 'pres16': 0.50407989, 2006: [0.30456392], 2008: [], 2010: [0.00013123], 2012: [0.4714785], 2014: [], 2016: [0.51733264], 2018: [0.45]}, 'wy': {'pres08': 0.66562023, 'pres12': 0.71160634, 'pres16': 0.7570532, 2006: [0.70094636], 2008: [0.75716225, 0.73441117], 2010: [], 2012: [0.77748259], 2014: [0.80536139], 2016: [], 2018: [0.67]}};
		for (var i in eData){
			eData[i].rpred = eData[i].pres16;
			eData[i].pres20 = eData[i].pres16;
			eData[i].sen20 = eData[i].pres16;
			if (userData20[i]){
				if (userData20[i].party == 'R'){
					eData[i].rpred = userData20[i].user/200+.5;
					eData[i].pres20 = userData20[i].pres20/200+.5;
					eData[i].sen20 = userData20[i].sen20/200+.5;
				}
				else if (userData20[i].party == 'D'){
					eData[i].rpred = .5-userData20[i].user/200;
					eData[i].pres20 = .5-userData20[i].pres20/200;
					eData[i].sen20 = .5-userData20[i].sen20/200;
				}
				
			}
			eData[i].rpred16 = eData[i].pres16;
			if (userData16[i]){
				if (userData16[i].party == 'R'){
					eData[i].rpred16 = userData16[i].user/200+.5;
				}
				else if (userData16[i].party == 'D'){
					eData[i].rpred16 = .5-userData16[i].user/200;
				}
				
			}
		}
		res.write(nunjucks.render('templates/senatemap.html',{
			senateData: eData,

		}));
		res.end();
	}
);

app.get(['/senatemap','/senatemap.html'],
	function(req, res){
		
		var senateData = {'al': {'pres08': 0.60890903, 'pres12': 0.61216229, 'pres16': 0.64374144, 2006: [], 2008: [0.63436655], 2010: [0.65250101], 2012: [], 2014: [1.0], 2016: [0.6407024], 2018: [0.48]}, 'ak': {'pres08': 0.61064785, 'pres12': 0.5731529, 'pres16': 0.58385655, 2006: [], 2008: [0.49340245], 2010: [0.60204528], 2012: [], 2014: [0.51135248], 2016: [0.79237048], 2018: []}, 'az': {'pres08': 0.54313901, 'pres12': 0.5461338, 'pres16': 0.51890023, 2006: [0.55081266], 2008: [], 2010: [0.62944331], 2012: [0.51586059], 2014: [.5686], 2016: [0.56860915], 2018: [0.49]}, 'ar': {'pres08': 0.60171721, 'pres12': 0.62154405, 'pres16': 0.64285138, 2006: [], 2008: [0.0], 2010: [0.61048104], 2012: [], 2014: [0.58895833], 2016: [0.62299334], 2018: []}, 'ca': {'pres08': 0.3772155, 'pres12': 0.38127189, 'pres16': 0.33871779, 2006: [0.37074264], 2008: [], 2010: [0.4469534], 2012: [0.37475716], 2014: [], 2016: [0.0], 2018: [0.0]}, 'co': {'pres08': 0.45449365, 'pres12': 0.47252012, 'pres16': 0.47316667, 2006: [], 2008: [0.44593471], 2010: [0.49138188], 2012: [], 2014: [0.51029203], 2016: [0.46995547], 2018: []}, 'ct': {'pres08': 0.38681662, 'pres12': 0.41227423, 'pres16': 0.42858452, 2006: [0.1949818], 2008: [], 2010: [0.45158195], 2012: [0.43259142], 2014: [], 2016: [0.37506846], 2018: [0.42]}, 'de': {'pres08': 0.37361861, 'pres12': 0.40553045, 'pres16': 0.44001379, 2006: [0.29019438], 2008: [0.35313487], 2010: [0.41422921], 2012: [0.30358291], 2014: [0.43064259], 2016: [], 2018: [0.4]}, 'dc': {'pres08': 0.06599232, 'pres12': 0.07412351, 'pres16': 0.04304812, 2006: [], 2008: [], 2010: [], 2012: [], 2014: [], 2016: [], 2018: []}, 'fl': {'pres08': 0.4858034, 'pres12': 0.49557748, 'pres16': 0.50618835, 2006: [0.38716405], 2008: [], 2010: [0.70766787], 2012: [0.43327351], 2014: [], 2016: [0.53980578], 2018: [0.51]}, 'ga': {'pres08': 0.52628336, 'pres12': 0.53956649, 'pres16': 0.52661173, 2006: [], 2008: [0.31525622], 2010: [0.59921654], 2012: [], 2014: [0.53915937], 2016: [0.57175417], 2018: []}, 'hi': {'pres08': 0.27006274, 'pres12': 0.28296151, 'pres16': 0.32558663, 2006: [0.37481237], 2008: [], 2010: [0.22381407], 2012: [0.37398457], 2014: [0.28421294], 2016: [0.23206356], 2018: [0.28]}, 'id': {'pres08': 0.6302459, 'pres12': 0.66421387, 'pres16': 0.68310177, 2006: [], 2008: [0.6283206], 2010: [0.7406148], 2012: [], 2014: [0.65328362], 2016: [0.70459902], 2018: []}, 'il': {'pres08': 0.37265736, 'pres12': 0.41422477, 'pres16': 0.40979949, 2006: [], 2008: [0.29604426], 2010: [0.50846441], 2012: [], 2014: [0.44361346], 2016: [0.42032449], 2018: []}, 'in': {'pres08': 0.49478047, 'pres12': 0.55200375, 'pres16': 0.6011731, 2006: [1.0], 2008: [], 2010: [0.57707812], 2012: [0.46944677], 2014: [], 2016: [0.55130669], 2018: [0.53]}, 'ia': {'pres08': 0.45151222, 'pres12': 0.47040648, 'pres16': 0.55063548, 2006: [], 2008: [0.3729219], 2010: [0.6589727], 2012: [], 2014: [0.54349482], 2016: [0.62760265], 2018: []}, 'ks': {'pres08': 0.57612276, 'pres12': 0.61113327, 'pres16': 0.6111147, 2006: [], 2008: [0.62225807], 2010: [0.72657045], 2012: [], 2014: [1.0], 2016: [0.65854281], 2018: []}, 'ky': {'pres08': 0.58233428, 'pres12': 0.61542772, 'pres16': 0.65670629, 2006: [], 2008: [0.5296562], 2010: [0.55740479], 2012: [], 2014: [0.57980287], 2016: [0.57274552], 2018: []}, 'la': {'pres08': 0.59457174, 'pres12': 0.58746826, 'pres16': 0.60171677, 2006: [], 2008: [0.46736119], 2010: [0.60018691], 2012: [], 2014: [0.52308918], 2016: [0.6065461], 2018: []}, 'me': {'pres08': 0.41170475, 'pres12': 0.42140079, 'pres16': 0.48403209, 2006: [0.78190647], 2008: [0.61383512], 2010: [], 2012: [0.36758826], 2014: [0.6848842], 2016: [], 2018: [0.46]}, 'md': {'pres08': 0.37069913, 'pres12': 0.36678274, 'pres16': 0.3598375, 2006: [0.44913586], 2008: [], 2010: [0.36503012], 2012: [0.31988415], 2014: [], 2016: [0.36944741], 2018: [0.36]}, 'ma': {'pres08': 0.36802922, 'pres12': 0.38214319, 'pres16': 0.35348721, 2006: [0.30594329], 2008: [0.31954391], 2010: [], 2012: [0.46222761], 2014: [0.38039881], 2016: [], 2018: [0.4]}, 'mi': {'pres08': 0.41628698, 'pres12': 0.45199468, 'pres16': 0.50117668, 2006: [0.42027743], 2008: [0.35069675], 2010: [], 2012: [0.39247231], 2014: [0.43076489], 2016: [], 2018: [0.47]}, 'mn': {'pres08': 0.44770625, 'pres12': 0.46058774, 'pres16': 0.49168306, 2006: [0.39520086], 2008: [0.49993567], 2010: [], 2012: [0.31880698], 2014: [0.44668105], 2016: [], 2018: [0.39, 0.46]}, 'ms': {'pres08': 0.56641931, 'pres12': 0.55801899, 'pres16': 0.59089847, 2006: [0.64582582], 2008: [0.61435046, 1.0], 2010: [], 2012: [0.58497246], 2014: [0.61250809], 2016: [], 2018: [0.54, 0.59]}, 'mo': {'pres08': 0.50067579, 'pres12': 0.54778667, 'pres16': 0.59818561, 2006: [0.48828579], 2008: [], 2010: [0.57170253], 2012: [0.41642216], 2014: [], 2016: [0.51460769], 2018: [0.52]}, 'mt': {'pres08': 0.51169403, 'pres12': 0.57034232, 'pres16': 0.61109664, 2006: [0.49550398], 2008: [0.27084022], 2010: [], 2012: [0.48010454], 2014: [0.5905309], 2016: [], 2018: [0.49]}, 'ne': {'pres08': 0.57609074, 'pres12': 0.6112939, 'pres16': 0.63547674, 2006: [0.36117208], 2008: [0.58948417], 2010: [], 2012: [0.57774433], 2014: [0.67141916], 2016: [], 2018: [0.58]}, 'nv': {'pres08': 0.43613262, 'pres12': 0.46592458, 'pres16': 0.48706291, 2006: [0.57456391], 2008: [], 2010: [0.46972576], 2012: [0.50640453], 2014: [], 2016: [0.4867684], 2018: [0.48]}, 'nh': {'pres08': 0.45131459, 'pres12': 0.47166248, 'pres16': 0.49802972, 2006: [], 2008: [0.46727682], 2010: [0.61987508], 2012: [], 2014: [0.48372457], 2016: [0.49928206], 2018: []}, 'nj': {'pres08': 0.4213537, 'pres12': 0.41048034, 'pres16': 0.4271581, 2006: [0.45381917], 2008: [0.42817144], 2010: [], 2012: [0.40079838], 2014: [0.43118622], 2016: [], 2018: [0.46]}, 'nm': {'pres08': 0.423351, 'pres12': 0.44704795, 'pres16': 0.45349205, 2006: [0.0009095], 2008: [0.38672009], 2010: [], 2012: [0.47024206], 2014: [0.4444119], 2016: [], 2018: [0.46]}, 'ny': {'pres08': 0.34236143, 'pres12': 0.33957305, 'pres16': 0.36588494, 2006: [0.31005976], 2008: [], 2010: [0.28912171, 0.32047667], 2012: [0.25521923], 2014: [], 2016: [0.26488753], 2018: [0.33]}, 'nc': {'pres08': 0.49834037, 'pres12': 0.51034035, 'pres16': 0.51903746, 2006: [], 2008: [0.45627065], 2010: [0.56011479], 2012: [], 2014: [0.50814164], 2016: [0.5295356], 2018: []}, 'nd': {'pres08': 0.54408656, 'pres12': 0.60111208, 'pres16': 0.69809243, 2006: [0.30022418], 2008: [], 2010: [0.77431769], 2012: [0.49540874], 2014: [], 2016: [0.82222304], 2018: [0.55]}, 'oh': {'pres08': 0.47666159, 'pres12': 0.48485943, 'pres16': 0.54267685, 2006: [0.43824268], 2008: [], 2010: [0.59060974], 2012: [0.46855014], 2014: [], 2016: [0.6096339], 2018: [0.47]}, 'ok': {'pres08': 0.65645081, 'pres12': 0.6677232, 'pres16': 0.69304737, 2006: [], 2008: [0.59125435], 2010: [0.72994506], 2012: [], 2014: [0.70433441, 0.70069755], 2016: [0.73375957], 2018: []}, 'or': {'pres08': 0.41586279, 'pres12': 0.43728833, 'pres16': 0.43844161, 2006: [], 2008: [0.4822608], 2010: [0.40683808], 2012: [], 2014: [0.3981479], 2016: [0.37074179], 2018: []}, 'pa': {'pres08': 0.44770296, 'pres12': 0.47268066, 'pres16': 0.50375536, 2006: [0.41316242], 2008: [], 2010: [0.51008495], 2012: [0.45369023], 2014: [], 2016: [0.5074518], 2018: [0.44]}, 'ri': {'pres08': 0.35801862, 'pres12': 0.35983254, 'pres16': 0.41689296, 2006: [0.46481365], 2008: [0.26595516], 2010: [], 2012: [0.35043714], 2014: [0.29297096], 2016: [], 2018: [0.38]}, 'sc': {'pres08': 0.54544429, 'pres12': 0.55308255, 'pres16': 0.57460256, 2006: [], 2008: [0.57656381], 2010: [0.68980125], 2012: [], 2014: [0.59569856, 0.62230132], 2016: [0.6379825], 2018: []}, 'sd': {'pres08': 0.54295707, 'pres12': 0.59218499, 'pres16': 0.65971858, 2006: [], 2008: [0.37508308], 2010: [1.0], 2012: [], 2014: [0.63056851], 2016: [0.71827862], 2018: []}, 'tn': {'pres08': 0.57631472, 'pres12': 0.60351072, 'pres16': 0.63624343, 2006: [0.51379506], 2008: [0.6730593], 2010: [], 2012: [0.68093205], 2014: [0.66003874], 2016: [], 2018: [0.54]}, 'tx': {'pres08': 0.55935937, 'pres12': 0.58007897, 'pres16': 0.54713226, 2006: [0.63120576], 2008: [0.56135139], 2010: [], 2012: [0.58154549], 2014: [0.64175457], 2016: [], 2018: [0.51]}, 'ut': {'pres08': 0.64526361, 'pres12': 0.74626189, 'pres16': 0.62382898, 2006: [0.6674911], 2008: [], 2010: [0.65274435], 2012: [0.68537887], 2014: [], 2016: [0.71578547], 2018: [0.63]}, 'vt': {'pres08': 0.31100818, 'pres12': 0.31752741, 'pres16': 0.34813574, 2006: [0.33100771], 2008: [], 2010: [0.32457809], 2012: [0.2596582], 2014: [], 2016: [0.350267], 2018: [0.3]}, 'va': {'pres08': 0.46817416, 'pres12': 0.48032623, 'pres16': 0.47173624, 2006: [0.49800823], 2008: [0.3415165], 2010: [], 2012: [0.47042306], 2014: [0.49583796], 2016: [], 2018: [0.43]}, 'wa': {'pres08': 0.41247973, 'pres12': 0.42371702, 'pres16': 0.41213069, 2006: [0.41259443], 2008: [], 2010: [0.47635174], 2012: [0.39549009], 2014: [], 2016: [0.4098699], 2018: [0.4]}, 'wv': {'pres08': 0.56673744, 'pres12': 0.63674298, 'pres16': 0.72161052, 2006: [0.22950978], 2008: [0.36262174], 2010: [0.4480444], 2012: [0.37582743], 2014: [0.64316035], 2016: [], 2018: [0.48]}, 'wi': {'pres08': 0.42944322, 'pres12': 0.4653657, 'pres16': 0.50407989, 2006: [0.30456392], 2008: [], 2010: [0.00013123], 2012: [0.4714785], 2014: [], 2016: [0.51733264], 2018: [0.45]}, 'wy': {'pres08': 0.66562023, 'pres12': 0.71160634, 'pres16': 0.7570532, 2006: [0.70094636], 2008: [0.75716225, 0.73441117], 2010: [], 2012: [0.77748259], 2014: [0.80536139], 2016: [], 2018: [0.67]}};

		res.write(nunjucks.render('templates/senatemap.html',{
			senateData: senateData,

		}));
		res.end();
	}
);

app.post(['/presmap','/presmap.html'],
	function(req, res){
		var nAdv = 0;
		var uncertainty = 0;
		var correlationDivisor = 0;
		var correlationPower = 0;
		if (req.body['nAdv']){
			nAdv = parseInt(req.body['nAdv'])/1000;
		}
		if (req.body['uncertainty']){
			uncertainty = parseInt(req.body['uncertainty'])+75;
		}
		if (req.body['nAdv']){
			correlationDivisor = parseInt(req.body['correlationDivisor'])+333;
		}
		if (req.body['nAdv']){
			correlationPower = parseFloat(req.body['correlationPower'])/100+3;
		}
		var eData = [{'abbrev': 'dc', 'votes16': 295553, 'ev10': 3, 'pres08': 0.06599232, 'pres12': 0.07412351, 'rperc': 0.04304812}, {'abbrev': 'hi', 'votes16': 395738, 'ev10': 4, 'pres08': 0.27006274, 'pres12': 0.28296151, 'rperc': 0.32558663}, {'abbrev': 'ca', 'votes16': 13237598, 'ev10': 55, 'pres08': 0.3772155, 'pres12': 0.38127189, 'rperc': 0.33871779}, {'abbrev': 'vt', 'votes16': 273942, 'ev10': 3, 'pres08': 0.31100818, 'pres12': 0.31752741, 'rperc': 0.34813574}, {'abbrev': 'ma', 'votes16': 3086089, 'ev10': 11, 'pres08': 0.36802922, 'pres12': 0.38214319, 'rperc': 0.35348721}, {'abbrev': 'md', 'votes16': 2621097, 'ev10': 10, 'pres08': 0.37069913, 'pres12': 0.36678274, 'rperc': 0.3598375}, {'abbrev': 'ny', 'votes16': 6906931, 'ev10': 29, 'pres08': 0.34236143, 'pres12': 0.33957305, 'rperc': 0.36588494}, {'abbrev': 'il', 'votes16': 5236744, 'ev10': 20, 'pres08': 0.37265736, 'pres12': 0.41422477, 'rperc': 0.40979949}, {'abbrev': 'wa', 'votes16': 2964465, 'ev10': 12, 'pres08': 0.41247973, 'pres12': 0.42371702, 'rperc': 0.41213069}, {'abbrev': 'ri', 'votes16': 433068, 'ev10': 4, 'pres08': 0.35801862, 'pres12': 0.35983254, 'rperc': 0.41689296}, {'abbrev': 'nj', 'votes16': 3750211, 'ev10': 14, 'pres08': 0.4213537, 'pres12': 0.41048034, 'rperc': 0.4271581}, {'abbrev': 'ct', 'votes16': 1570787, 'ev10': 7, 'pres08': 0.38681662, 'pres12': 0.41227423, 'rperc': 0.42858452}, {'abbrev': 'or', 'votes16': 1784509, 'ev10': 7, 'pres08': 0.41586279, 'pres12': 0.43728833, 'rperc': 0.43844161}, {'abbrev': 'de', 'votes16': 420730, 'ev10': 3, 'pres08': 0.37361861, 'pres12': 0.40553045, 'rperc': 0.44001379}, {'abbrev': 'nm', 'votes16': 704901, 'ev10': 5, 'pres08': 0.423351, 'pres12': 0.44704795, 'rperc': 0.45349205}, {'abbrev': 'va', 'votes16': 3750916, 'ev10': 13, 'pres08': 0.46817416, 'pres12': 0.48032623, 'rperc': 0.47173624}, {'abbrev': 'co', 'votes16': 2541354, 'ev10': 9, 'pres08': 0.45449365, 'pres12': 0.47252012, 'rperc': 0.47316667}, {'abbrev': 'me', 'votes16': 693328, 'ev10': 4, 'pres08': 0.41170475, 'pres12': 0.42140079, 'rperc': 0.48403209}, {'abbrev': 'nv', 'votes16': 1051318, 'ev10': 6, 'pres08': 0.43613262, 'pres12': 0.46592458, 'rperc': 0.48706291}, {'abbrev': 'mn', 'votes16': 2690654, 'ev10': 10, 'pres08': 0.44770625, 'pres12': 0.46058774, 'rperc': 0.49168306}, {'abbrev': 'nh', 'votes16': 694316, 'ev10': 4, 'pres08': 0.45131459, 'pres12': 0.47166248, 'rperc': 0.49802972}, {'abbrev': 'mi', 'votes16': 4548382, 'ev10': 16, 'pres08': 0.41628698, 'pres12': 0.45199468, 'rperc': 0.50117668}, {'abbrev': 'pa', 'votes16': 5897174, 'ev10': 20, 'pres08': 0.44770296, 'pres12': 0.47268066, 'rperc': 0.50375536}, {'abbrev': 'wi', 'votes16': 2787820, 'ev10': 10, 'pres08': 0.42944322, 'pres12': 0.4653657, 'rperc': 0.50407989}, {'abbrev': 'fl', 'votes16': 9122861, 'ev10': 29, 'pres08': 0.4858034, 'pres12': 0.49557748, 'rperc': 0.50618835}, {'abbrev': 'az', 'votes16': 2413568, 'ev10': 11, 'pres08': 0.54313901, 'pres12': 0.5461338, 'rperc': 0.51890023}, {'abbrev': 'nc', 'votes16': 4551947, 'ev10': 15, 'pres08': 0.49834037, 'pres12': 0.51034035, 'rperc': 0.51903746}, {'abbrev': 'ga', 'votes16': 3967067, 'ev10': 16, 'pres08': 0.52628336, 'pres12': 0.53956649, 'rperc': 0.52661173}, {'abbrev': 'oh', 'votes16': 5235169, 'ev10': 18, 'pres08': 0.47666159, 'pres12': 0.48485943, 'rperc': 0.54267685}, {'abbrev': 'tx', 'votes16': 8562915, 'ev10': 38, 'pres08': 0.55935937, 'pres12': 0.58007897, 'rperc': 0.54713226}, {'abbrev': 'ia', 'votes16': 1454652, 'ev10': 6, 'pres08': 0.45151222, 'pres12': 0.47040648, 'rperc': 0.55063548}, {'abbrev': 'sc', 'votes16': 2010762, 'ev10': 9, 'pres08': 0.54544429, 'pres12': 0.55308255, 'rperc': 0.57460256}, {'abbrev': 'ak', 'votes16': 279841, 'ev10': 3, 'pres08': 0.61064785, 'pres12': 0.5731529, 'rperc': 0.58385655}, {'abbrev': 'ms', 'votes16': 1185845, 'ev10': 6, 'pres08': 0.56641931, 'pres12': 0.55801899, 'rperc': 0.59089847}, {'abbrev': 'mo', 'votes16': 2665579, 'ev10': 10, 'pres08': 0.50067579, 'pres12': 0.54778667, 'rperc': 0.59818561}, {'abbrev': 'in', 'votes16': 2590412, 'ev10': 11, 'pres08': 0.49478047, 'pres12': 0.55200375, 'rperc': 0.6011731}, {'abbrev': 'la', 'votes16': 1958792, 'ev10': 8, 'pres08': 0.59457174, 'pres12': 0.58746826, 'rperc': 0.60171677}, {'abbrev': 'mt', 'votes16': 456949, 'ev10': 3, 'pres08': 0.51169403, 'pres12': 0.57034232, 'rperc': 0.61109664}, {'abbrev': 'ks', 'votes16': 1098023, 'ev10': 6, 'pres08': 0.57612276, 'pres12': 0.61113327, 'rperc': 0.6111147}, {'abbrev': 'ut', 'votes16': 825885, 'ev10': 6, 'pres08': 0.64526361, 'pres12': 0.74626189, 'rperc': 0.62382898}, {'abbrev': 'ne', 'votes16': 780455, 'ev10': 5, 'pres08': 0.57609074, 'pres12': 0.6112939, 'rperc': 0.63547674}, {'abbrev': 'tn', 'votes16': 2393620, 'ev10': 11, 'pres08': 0.57631472, 'pres12': 0.60351072, 'rperc': 0.63624343}, {'abbrev': 'ar', 'votes16': 1065366, 'ev10': 6, 'pres08': 0.60171721, 'pres12': 0.62154405, 'rperc': 0.64285138}, {'abbrev': 'al', 'votes16': 2047802, 'ev10': 9, 'pres08': 0.60890903, 'pres12': 0.61216229, 'rperc': 0.64374144}, {'abbrev': 'ky', 'votes16': 1831825, 'ev10': 8, 'pres08': 0.58233428, 'pres12': 0.61542772, 'rperc': 0.65670629}, {'abbrev': 'sd', 'votes16': 345179, 'ev10': 3, 'pres08': 0.54295707, 'pres12': 0.59218499, 'rperc': 0.65971858}, {'abbrev': 'id', 'votes16': 598820, 'ev10': 4, 'pres08': 0.6302459, 'pres12': 0.66421387, 'rperc': 0.68310177}, {'abbrev': 'ok', 'votes16': 1369511, 'ev10': 7, 'pres08': 0.65645081, 'pres12': 0.6677232, 'rperc': 0.69304737}, {'abbrev': 'nd', 'votes16': 310552, 'ev10': 3, 'pres08': 0.54408656, 'pres12': 0.60111208, 'rperc': 0.69809243}, {'abbrev': 'wv', 'votes16': 678165, 'ev10': 5, 'pres08': 0.56673744, 'pres12': 0.63674298, 'rperc': 0.72161052}, {'abbrev': 'wy', 'votes16': 230392, 'ev10': 3, 'pres08': 0.66562023, 'pres12': 0.71160634, 'rperc': 0.7570532}];
		for (var i=0;i<eData.length;i++){
			eData[i].rpred = eData[i].rperc+nAdv;
			eData[i].pres16 = eData[i].rperc;
			delete eData[i].rperc;
		}
		res.write(nunjucks.render('templates/map.html',{
			electoralData: eData,
			uncertainty: uncertainty,
			correlationDivisor: correlationDivisor,
			correlationPower: correlationPower,

		}));
		res.end();
	}
);

app.post(['/map','/map.html'],
	function(req, res){
		var userData16 = {};
		var userData20 = {};
		for (var i in req.body){
			if (req.body[i] != ''){
				var p = parseFloat(req.body[i]);
				var state = i.split('-');
				if (state[1]=="2016"){
					userData16[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				else if (state[1]=="2020"){
					userData20[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				
			}
		}
		for (var i in req.body){
			if (req.body[i] != ''){
				var p = parseFloat(req.body[i]);
				var state = i.split('-');
				if (state.length > 3){
					continue;
				}
				if (state[1]=="2016"){
					userData16[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				else if (state[1]=="2020"){
					userData20[state[0].toLowerCase()]={'party':state[2],'user':p};
				}
				
			}
		}
		var eData = [{'abbrev': 'dc', 'votes16': 295553, 'ev10': 3, 'pres08': 0.06599232, 'pres12': 0.07412351, 'rperc': 0.04304812}, {'abbrev': 'hi', 'votes16': 395738, 'ev10': 4, 'pres08': 0.27006274, 'pres12': 0.28296151, 'rperc': 0.32558663}, {'abbrev': 'ca', 'votes16': 13237598, 'ev10': 55, 'pres08': 0.3772155, 'pres12': 0.38127189, 'rperc': 0.33871779}, {'abbrev': 'vt', 'votes16': 273942, 'ev10': 3, 'pres08': 0.31100818, 'pres12': 0.31752741, 'rperc': 0.34813574}, {'abbrev': 'ma', 'votes16': 3086089, 'ev10': 11, 'pres08': 0.36802922, 'pres12': 0.38214319, 'rperc': 0.35348721}, {'abbrev': 'md', 'votes16': 2621097, 'ev10': 10, 'pres08': 0.37069913, 'pres12': 0.36678274, 'rperc': 0.3598375}, {'abbrev': 'ny', 'votes16': 6906931, 'ev10': 29, 'pres08': 0.34236143, 'pres12': 0.33957305, 'rperc': 0.36588494}, {'abbrev': 'il', 'votes16': 5236744, 'ev10': 20, 'pres08': 0.37265736, 'pres12': 0.41422477, 'rperc': 0.40979949}, {'abbrev': 'wa', 'votes16': 2964465, 'ev10': 12, 'pres08': 0.41247973, 'pres12': 0.42371702, 'rperc': 0.41213069}, {'abbrev': 'ri', 'votes16': 433068, 'ev10': 4, 'pres08': 0.35801862, 'pres12': 0.35983254, 'rperc': 0.41689296}, {'abbrev': 'nj', 'votes16': 3750211, 'ev10': 14, 'pres08': 0.4213537, 'pres12': 0.41048034, 'rperc': 0.4271581}, {'abbrev': 'ct', 'votes16': 1570787, 'ev10': 7, 'pres08': 0.38681662, 'pres12': 0.41227423, 'rperc': 0.42858452}, {'abbrev': 'or', 'votes16': 1784509, 'ev10': 7, 'pres08': 0.41586279, 'pres12': 0.43728833, 'rperc': 0.43844161}, {'abbrev': 'de', 'votes16': 420730, 'ev10': 3, 'pres08': 0.37361861, 'pres12': 0.40553045, 'rperc': 0.44001379}, {'abbrev': 'nm', 'votes16': 704901, 'ev10': 5, 'pres08': 0.423351, 'pres12': 0.44704795, 'rperc': 0.45349205}, {'abbrev': 'va', 'votes16': 3750916, 'ev10': 13, 'pres08': 0.46817416, 'pres12': 0.48032623, 'rperc': 0.47173624}, {'abbrev': 'co', 'votes16': 2541354, 'ev10': 9, 'pres08': 0.45449365, 'pres12': 0.47252012, 'rperc': 0.47316667}, {'abbrev': 'me', 'votes16': 693328, 'ev10': 4, 'pres08': 0.41170475, 'pres12': 0.42140079, 'rperc': 0.48403209}, {'abbrev': 'nv', 'votes16': 1051318, 'ev10': 6, 'pres08': 0.43613262, 'pres12': 0.46592458, 'rperc': 0.48706291}, {'abbrev': 'mn', 'votes16': 2690654, 'ev10': 10, 'pres08': 0.44770625, 'pres12': 0.46058774, 'rperc': 0.49168306}, {'abbrev': 'nh', 'votes16': 694316, 'ev10': 4, 'pres08': 0.45131459, 'pres12': 0.47166248, 'rperc': 0.49802972}, {'abbrev': 'mi', 'votes16': 4548382, 'ev10': 16, 'pres08': 0.41628698, 'pres12': 0.45199468, 'rperc': 0.50117668}, {'abbrev': 'pa', 'votes16': 5897174, 'ev10': 20, 'pres08': 0.44770296, 'pres12': 0.47268066, 'rperc': 0.50375536}, {'abbrev': 'wi', 'votes16': 2787820, 'ev10': 10, 'pres08': 0.42944322, 'pres12': 0.4653657, 'rperc': 0.50407989}, {'abbrev': 'fl', 'votes16': 9122861, 'ev10': 29, 'pres08': 0.4858034, 'pres12': 0.49557748, 'rperc': 0.50618835}, {'abbrev': 'az', 'votes16': 2413568, 'ev10': 11, 'pres08': 0.54313901, 'pres12': 0.5461338, 'rperc': 0.51890023}, {'abbrev': 'nc', 'votes16': 4551947, 'ev10': 15, 'pres08': 0.49834037, 'pres12': 0.51034035, 'rperc': 0.51903746}, {'abbrev': 'ga', 'votes16': 3967067, 'ev10': 16, 'pres08': 0.52628336, 'pres12': 0.53956649, 'rperc': 0.52661173}, {'abbrev': 'oh', 'votes16': 5235169, 'ev10': 18, 'pres08': 0.47666159, 'pres12': 0.48485943, 'rperc': 0.54267685}, {'abbrev': 'tx', 'votes16': 8562915, 'ev10': 38, 'pres08': 0.55935937, 'pres12': 0.58007897, 'rperc': 0.54713226}, {'abbrev': 'ia', 'votes16': 1454652, 'ev10': 6, 'pres08': 0.45151222, 'pres12': 0.47040648, 'rperc': 0.55063548}, {'abbrev': 'sc', 'votes16': 2010762, 'ev10': 9, 'pres08': 0.54544429, 'pres12': 0.55308255, 'rperc': 0.57460256}, {'abbrev': 'ak', 'votes16': 279841, 'ev10': 3, 'pres08': 0.61064785, 'pres12': 0.5731529, 'rperc': 0.58385655}, {'abbrev': 'ms', 'votes16': 1185845, 'ev10': 6, 'pres08': 0.56641931, 'pres12': 0.55801899, 'rperc': 0.59089847}, {'abbrev': 'mo', 'votes16': 2665579, 'ev10': 10, 'pres08': 0.50067579, 'pres12': 0.54778667, 'rperc': 0.59818561}, {'abbrev': 'in', 'votes16': 2590412, 'ev10': 11, 'pres08': 0.49478047, 'pres12': 0.55200375, 'rperc': 0.6011731}, {'abbrev': 'la', 'votes16': 1958792, 'ev10': 8, 'pres08': 0.59457174, 'pres12': 0.58746826, 'rperc': 0.60171677}, {'abbrev': 'mt', 'votes16': 456949, 'ev10': 3, 'pres08': 0.51169403, 'pres12': 0.57034232, 'rperc': 0.61109664}, {'abbrev': 'ks', 'votes16': 1098023, 'ev10': 6, 'pres08': 0.57612276, 'pres12': 0.61113327, 'rperc': 0.6111147}, {'abbrev': 'ut', 'votes16': 825885, 'ev10': 6, 'pres08': 0.64526361, 'pres12': 0.74626189, 'rperc': 0.62382898}, {'abbrev': 'ne', 'votes16': 780455, 'ev10': 5, 'pres08': 0.57609074, 'pres12': 0.6112939, 'rperc': 0.63547674}, {'abbrev': 'tn', 'votes16': 2393620, 'ev10': 11, 'pres08': 0.57631472, 'pres12': 0.60351072, 'rperc': 0.63624343}, {'abbrev': 'ar', 'votes16': 1065366, 'ev10': 6, 'pres08': 0.60171721, 'pres12': 0.62154405, 'rperc': 0.64285138}, {'abbrev': 'al', 'votes16': 2047802, 'ev10': 9, 'pres08': 0.60890903, 'pres12': 0.61216229, 'rperc': 0.64374144}, {'abbrev': 'ky', 'votes16': 1831825, 'ev10': 8, 'pres08': 0.58233428, 'pres12': 0.61542772, 'rperc': 0.65670629}, {'abbrev': 'sd', 'votes16': 345179, 'ev10': 3, 'pres08': 0.54295707, 'pres12': 0.59218499, 'rperc': 0.65971858}, {'abbrev': 'id', 'votes16': 598820, 'ev10': 4, 'pres08': 0.6302459, 'pres12': 0.66421387, 'rperc': 0.68310177}, {'abbrev': 'ok', 'votes16': 1369511, 'ev10': 7, 'pres08': 0.65645081, 'pres12': 0.6677232, 'rperc': 0.69304737}, {'abbrev': 'nd', 'votes16': 310552, 'ev10': 3, 'pres08': 0.54408656, 'pres12': 0.60111208, 'rperc': 0.69809243}, {'abbrev': 'wv', 'votes16': 678165, 'ev10': 5, 'pres08': 0.56673744, 'pres12': 0.63674298, 'rperc': 0.72161052}, {'abbrev': 'wy', 'votes16': 230392, 'ev10': 3, 'pres08': 0.66562023, 'pres12': 0.71160634, 'rperc': 0.7570532}];
		for (var i=0;i<eData.length;i++){
			eData[i].rpred = eData[i].rperc;
			if (userData20[eData[i].abbrev]){
				if (userData20[eData[i].abbrev].party == 'R'){
					eData[i].rpred = userData20[eData[i].abbrev].user/200+.5;
				}
				else if (userData20[eData[i].abbrev].party == 'D'){
					eData[i].rpred = .5-userData20[eData[i].abbrev].user/200;
				}
				
			}
			eData[i].rpred16 = eData[i].rperc;
			if (userData16[eData[i].abbrev]){
				if (userData16[eData[i].abbrev].party == 'R'){
					eData[i].rpred16 = userData16[eData[i].abbrev].user/200+.5;
				}
				else if (userData16[eData[i].abbrev].party == 'D'){
					eData[i].rpred16 = .5-userData16[eData[i].abbrev].user/200;
				}
				
			}
			eData[i].pres16 = eData[i].rperc;
			delete eData[i].rperc;
		}
		res.write(nunjucks.render('templates/map.html',{
			electoralData: eData,
			uncertainty: 75,
			correlationDivisor: 160,
			correlationPower: 3,

		}));
		res.end();
	}
);



app.get(['/','/draw','/draw.html'],
	function(req, res){
		
		var hData = [{'abbrev': 'hi', 'votes16': 395738, 'ev10': 4, 'pres08': 0.27006274, 'pres12': 0.28296151, 'rperc': 0.32558663}, {'abbrev': 'ca', 'votes16': 13237598, 'ev10': 55, 'pres08': 0.3772155, 'pres12': 0.38127189, 'rperc': 0.33871779}, {'abbrev': 'vt', 'votes16': 273942, 'ev10': 3, 'pres08': 0.31100818, 'pres12': 0.31752741, 'rperc': 0.34813574}, {'abbrev': 'ma', 'votes16': 3086089, 'ev10': 11, 'pres08': 0.36802922, 'pres12': 0.38214319, 'rperc': 0.35348721}, {'abbrev': 'md', 'votes16': 2621097, 'ev10': 10, 'pres08': 0.37069913, 'pres12': 0.36678274, 'rperc': 0.3598375}, {'abbrev': 'ny', 'votes16': 6906931, 'ev10': 29, 'pres08': 0.34236143, 'pres12': 0.33957305, 'rperc': 0.36588494}, {'abbrev': 'il', 'votes16': 5236744, 'ev10': 20, 'pres08': 0.37265736, 'pres12': 0.41422477, 'rperc': 0.40979949}, {'abbrev': 'wa', 'votes16': 2964465, 'ev10': 12, 'pres08': 0.41247973, 'pres12': 0.42371702, 'rperc': 0.41213069}, {'abbrev': 'ri', 'votes16': 433068, 'ev10': 4, 'pres08': 0.35801862, 'pres12': 0.35983254, 'rperc': 0.41689296}, {'abbrev': 'nj', 'votes16': 3750211, 'ev10': 14, 'pres08': 0.4213537, 'pres12': 0.41048034, 'rperc': 0.4271581}, {'abbrev': 'ct', 'votes16': 1570787, 'ev10': 7, 'pres08': 0.38681662, 'pres12': 0.41227423, 'rperc': 0.42858452}, {'abbrev': 'or', 'votes16': 1784509, 'ev10': 7, 'pres08': 0.41586279, 'pres12': 0.43728833, 'rperc': 0.43844161}, {'abbrev': 'de', 'votes16': 420730, 'ev10': 3, 'pres08': 0.37361861, 'pres12': 0.40553045, 'rperc': 0.44001379}, {'abbrev': 'nm', 'votes16': 704901, 'ev10': 5, 'pres08': 0.423351, 'pres12': 0.44704795, 'rperc': 0.45349205}, {'abbrev': 'va', 'votes16': 3750916, 'ev10': 13, 'pres08': 0.46817416, 'pres12': 0.48032623, 'rperc': 0.47173624}, {'abbrev': 'co', 'votes16': 2541354, 'ev10': 9, 'pres08': 0.45449365, 'pres12': 0.47252012, 'rperc': 0.47316667}, {'abbrev': 'me', 'votes16': 693328, 'ev10': 4, 'pres08': 0.41170475, 'pres12': 0.42140079, 'rperc': 0.48403209}, {'abbrev': 'nv', 'votes16': 1051318, 'ev10': 6, 'pres08': 0.43613262, 'pres12': 0.46592458, 'rperc': 0.48706291}, {'abbrev': 'mn', 'votes16': 2690654, 'ev10': 10, 'pres08': 0.44770625, 'pres12': 0.46058774, 'rperc': 0.49168306}, {'abbrev': 'nh', 'votes16': 694316, 'ev10': 4, 'pres08': 0.45131459, 'pres12': 0.47166248, 'rperc': 0.49802972}, {'abbrev': 'mi', 'votes16': 4548382, 'ev10': 16, 'pres08': 0.41628698, 'pres12': 0.45199468, 'rperc': 0.50117668}, {'abbrev': 'pa', 'votes16': 5897174, 'ev10': 20, 'pres08': 0.44770296, 'pres12': 0.47268066, 'rperc': 0.50375536}, {'abbrev': 'wi', 'votes16': 2787820, 'ev10': 10, 'pres08': 0.42944322, 'pres12': 0.4653657, 'rperc': 0.50407989}, {'abbrev': 'fl', 'votes16': 9122861, 'ev10': 29, 'pres08': 0.4858034, 'pres12': 0.49557748, 'rperc': 0.50618835}, {'abbrev': 'az', 'votes16': 2413568, 'ev10': 11, 'pres08': 0.54313901, 'pres12': 0.5461338, 'rperc': 0.51890023}, {'abbrev': 'nc', 'votes16': 4551947, 'ev10': 15, 'pres08': 0.49834037, 'pres12': 0.51034035, 'rperc': 0.51903746}, {'abbrev': 'ga', 'votes16': 3967067, 'ev10': 16, 'pres08': 0.52628336, 'pres12': 0.53956649, 'rperc': 0.52661173}, {'abbrev': 'oh', 'votes16': 5235169, 'ev10': 18, 'pres08': 0.47666159, 'pres12': 0.48485943, 'rperc': 0.54267685}, {'abbrev': 'tx', 'votes16': 8562915, 'ev10': 38, 'pres08': 0.55935937, 'pres12': 0.58007897, 'rperc': 0.54713226}, {'abbrev': 'ia', 'votes16': 1454652, 'ev10': 6, 'pres08': 0.45151222, 'pres12': 0.47040648, 'rperc': 0.55063548}, {'abbrev': 'sc', 'votes16': 2010762, 'ev10': 9, 'pres08': 0.54544429, 'pres12': 0.55308255, 'rperc': 0.57460256}, {'abbrev': 'ak', 'votes16': 279841, 'ev10': 3, 'pres08': 0.61064785, 'pres12': 0.5731529, 'rperc': 0.58385655}, {'abbrev': 'ms', 'votes16': 1185845, 'ev10': 6, 'pres08': 0.56641931, 'pres12': 0.55801899, 'rperc': 0.59089847}, {'abbrev': 'mo', 'votes16': 2665579, 'ev10': 10, 'pres08': 0.50067579, 'pres12': 0.54778667, 'rperc': 0.59818561}, {'abbrev': 'in', 'votes16': 2590412, 'ev10': 11, 'pres08': 0.49478047, 'pres12': 0.55200375, 'rperc': 0.6011731}, {'abbrev': 'la', 'votes16': 1958792, 'ev10': 8, 'pres08': 0.59457174, 'pres12': 0.58746826, 'rperc': 0.60171677}, {'abbrev': 'mt', 'votes16': 456949, 'ev10': 3, 'pres08': 0.51169403, 'pres12': 0.57034232, 'rperc': 0.61109664}, {'abbrev': 'ks', 'votes16': 1098023, 'ev10': 6, 'pres08': 0.57612276, 'pres12': 0.61113327, 'rperc': 0.6111147}, {'abbrev': 'ut', 'votes16': 825885, 'ev10': 6, 'pres08': 0.64526361, 'pres12': 0.74626189, 'rperc': 0.62382898}, {'abbrev': 'ne', 'votes16': 780455, 'ev10': 5, 'pres08': 0.57609074, 'pres12': 0.6112939, 'rperc': 0.63547674}, {'abbrev': 'tn', 'votes16': 2393620, 'ev10': 11, 'pres08': 0.57631472, 'pres12': 0.60351072, 'rperc': 0.63624343}, {'abbrev': 'ar', 'votes16': 1065366, 'ev10': 6, 'pres08': 0.60171721, 'pres12': 0.62154405, 'rperc': 0.64285138}, {'abbrev': 'al', 'votes16': 2047802, 'ev10': 9, 'pres08': 0.60890903, 'pres12': 0.61216229, 'rperc': 0.64374144}, {'abbrev': 'ky', 'votes16': 1831825, 'ev10': 8, 'pres08': 0.58233428, 'pres12': 0.61542772, 'rperc': 0.65670629}, {'abbrev': 'sd', 'votes16': 345179, 'ev10': 3, 'pres08': 0.54295707, 'pres12': 0.59218499, 'rperc': 0.65971858}, {'abbrev': 'id', 'votes16': 598820, 'ev10': 4, 'pres08': 0.6302459, 'pres12': 0.66421387, 'rperc': 0.68310177}, {'abbrev': 'ok', 'votes16': 1369511, 'ev10': 7, 'pres08': 0.65645081, 'pres12': 0.6677232, 'rperc': 0.69304737}, {'abbrev': 'nd', 'votes16': 310552, 'ev10': 3, 'pres08': 0.54408656, 'pres12': 0.60111208, 'rperc': 0.69809243}, {'abbrev': 'wv', 'votes16': 678165, 'ev10': 5, 'pres08': 0.56673744, 'pres12': 0.63674298, 'rperc': 0.72161052}, {'abbrev': 'wy', 'votes16': 230392, 'ev10': 3, 'pres08': 0.66562023, 'pres12': 0.71160634, 'rperc': 0.7570532}];
		var tipping = [{'abbrev': 'Wyoming', 'seats': 1, 'rwin': 0.99865, 'half': 1}, {'abbrev': 'Wisconsin', 'seats': 104, 'rwin': 0.1315}, {'abbrev': 'West_Virginia', 'seats': 1, 'rwin': 0.986725, 'half': 1}, {'abbrev': 'Washington', 'seats': 1, 'rwin': 0.0075}, {'abbrev': 'Virginia', 'seats': 7, 'rwin': 0.0124}, {'abbrev': 'Vermont', 'seats': 1, 'rwin': 0.007925, 'half': 1}, {'abbrev': 'Utah', 'seats': 1, 'rwin': 0.9643, 'half': 1}, {'abbrev': 'Texas', 'seats': 8, 'rwin': 0.6852}, {'abbrev': 'Tennessee', 'seats': 1, 'rwin': 0.9631, 'half': 1}, {'abbrev': 'South_Dakota', 'seats': 1, 'rwin': 0.975575, 'half': 1}, {'abbrev': 'South_Carolina', 'seats': 1, 'rwin': 0.880675}, {'abbrev': 'Rhode_Island', 'seats': 1, 'rwin': 0.002375, 'half': 1}, {'abbrev': 'Pennsylvania', 'seats': 182, 'rwin': 0.12695}, {'abbrev': 'Oregon', 'seats': 3, 'rwin': 0.030725}, {'abbrev': 'Oklahoma', 'seats': 1, 'rwin': 0.993975, 'half': 1}, {'abbrev': 'Ohio', 'seats': 16, 'rwin': 0.4867}, {'abbrev': 'North_Dakota', 'seats': 1, 'rwin': 0.992875, 'half': 1}, {'abbrev': 'North_Carolina', 'seats': 38, 'rwin': 0.344825}, {'abbrev': 'New_York', 'seats': 1, 'rwin': 0.000175, 'half': 1}, {'abbrev': 'New_Mexico', 'seats': 7, 'rwin': 0.02845}, {'abbrev': 'New_Jersey', 'seats': 5, 'rwin': 0.015825}, {'abbrev': 'New_Hampshire', 'seats': 9, 'rwin': 0.151225}, {'abbrev': 'Nevada', 'seats': 23, 'rwin': 0.1407}, {'abbrev': 'Nebraska', 'seats': 1, 'rwin': 0.9883, 'half': 1}, {'abbrev': 'NE-3', 'seats': 1, 'rwin': 0.999625, 'half': 1}, {'abbrev': 'NE-2', 'seats': 8, 'rwin': 0.23315}, {'abbrev': 'NE-1', 'seats': 1, 'rwin': 0.94365, 'half': 1}, {'abbrev': 'Montana', 'seats': 1, 'rwin': 0.88695, 'half': 1}, {'abbrev': 'Missouri', 'seats': 1, 'rwin': 0.8987, 'half': 1}, {'abbrev': 'Mississippi', 'seats': 2, 'rwin': 0.86485}, {'abbrev': 'Minnesota', 'seats': 41, 'rwin': 0.09155}, {'abbrev': 'Michigan', 'seats': 86, 'rwin': 0.09}, {'abbrev': 'Massachusetts', 'seats': 1, 'rwin': 0.0007, 'half': 1}, {'abbrev': 'Maryland', 'seats': 1, 'rwin': 0.000375, 'half': 1}, {'abbrev': 'Maine', 'seats': 2, 'rwin': 0.10175}, {'abbrev': 'ME-2', 'seats': 3, 'rwin': 0.527175}, {'abbrev': 'ME-1', 'seats': 1, 'rwin': 0.019425, 'half': 1}, {'abbrev': 'Louisiana', 'seats': 1, 'rwin': 0.9273}, {'abbrev': 'Kentucky', 'seats': 1, 'rwin': 0.984925, 'half': 1}, {'abbrev': 'Kansas', 'seats': 1, 'rwin': 0.92505, 'half': 1}, {'abbrev': 'Iowa', 'seats': 5, 'rwin': 0.546625}, {'abbrev': 'Indiana', 'seats': 1, 'rwin': 0.949175, 'half': 1}, {'abbrev': 'Illinois', 'seats': 1, 'rwin': 0.00085, 'half': 1}, {'abbrev': 'Idaho', 'seats': 1, 'rwin': 0.996275, 'half': 1}, {'abbrev': 'Hawaii', 'seats': 1, 'rwin': 0.00785, 'half': 1}, {'abbrev': 'Georgia', 'seats': 13, 'rwin': 0.551575}, {'abbrev': 'Florida', 'seats': 121, 'rwin': 0.2628}, {'abbrev': 'District_of_Columbia', 'seats': 1, 'rwin': 0.0, 'half': 1}, {'abbrev': 'Delaware', 'seats': 1, 'rwin': 0.00015, 'half': 1}, {'abbrev': 'Connecticut', 'seats': 1, 'rwin': 0.002725, 'half': 1}, {'abbrev': 'Colorado', 'seats': 17, 'rwin': 0.06215}, {'abbrev': 'California', 'seats': 2, 'rwin': 0.001375}, {'abbrev': 'Arkansas', 'seats': 1, 'rwin': 0.979425, 'half': 1}, {'abbrev': 'Arizona', 'seats': 33, 'rwin': 0.3321}, {'abbrev': 'Alaska', 'seats': 1, 'rwin': 0.77235}, {'abbrev': 'Alabama', 'seats': 1, 'rwin': 0.9794, 'half': 1}]
		
		for (var i=0;i<hData.length;i++){
			hData[i].ev10 -= 2;
		}	
		for (var i=0;i<tipping.length;i++){
			tipping[i].name = tipping[i].abbrev;
			tipping[i].abbrev = tipping[i].abbrev.substr(0,7);
		}	
		tipping.sort(function(a,b){return b.seats - a.seats;})

		res.write(nunjucks.render('templates/draw.html',{
			states: tipping,
			load: "ptip",
			saveAs: "ptip",
			districts: false,
			val: 'seats',
			height: 24,
			width: 32,
		}));
		res.end();
	}
);

app.get(['/','/index','/index.html'],
	function(req, res){
		
		var eData = [{'abbrev': 'dc', 'votes16': 295553, 'ev10': 3, 'pres08': 0.06599232, 'pres12': 0.07412351, 'rperc': 0.04304812}, {'abbrev': 'hi', 'votes16': 395738, 'ev10': 4, 'pres08': 0.27006274, 'pres12': 0.28296151, 'rperc': 0.32558663}, {'abbrev': 'ca', 'votes16': 13237598, 'ev10': 55, 'pres08': 0.3772155, 'pres12': 0.38127189, 'rperc': 0.33871779}, {'abbrev': 'vt', 'votes16': 273942, 'ev10': 3, 'pres08': 0.31100818, 'pres12': 0.31752741, 'rperc': 0.34813574}, {'abbrev': 'ma', 'votes16': 3086089, 'ev10': 11, 'pres08': 0.36802922, 'pres12': 0.38214319, 'rperc': 0.35348721}, {'abbrev': 'md', 'votes16': 2621097, 'ev10': 10, 'pres08': 0.37069913, 'pres12': 0.36678274, 'rperc': 0.3598375}, {'abbrev': 'ny', 'votes16': 6906931, 'ev10': 29, 'pres08': 0.34236143, 'pres12': 0.33957305, 'rperc': 0.36588494}, {'abbrev': 'il', 'votes16': 5236744, 'ev10': 20, 'pres08': 0.37265736, 'pres12': 0.41422477, 'rperc': 0.40979949}, {'abbrev': 'wa', 'votes16': 2964465, 'ev10': 12, 'pres08': 0.41247973, 'pres12': 0.42371702, 'rperc': 0.41213069}, {'abbrev': 'ri', 'votes16': 433068, 'ev10': 4, 'pres08': 0.35801862, 'pres12': 0.35983254, 'rperc': 0.41689296}, {'abbrev': 'nj', 'votes16': 3750211, 'ev10': 14, 'pres08': 0.4213537, 'pres12': 0.41048034, 'rperc': 0.4271581}, {'abbrev': 'ct', 'votes16': 1570787, 'ev10': 7, 'pres08': 0.38681662, 'pres12': 0.41227423, 'rperc': 0.42858452}, {'abbrev': 'or', 'votes16': 1784509, 'ev10': 7, 'pres08': 0.41586279, 'pres12': 0.43728833, 'rperc': 0.43844161}, {'abbrev': 'de', 'votes16': 420730, 'ev10': 3, 'pres08': 0.37361861, 'pres12': 0.40553045, 'rperc': 0.44001379}, {'abbrev': 'nm', 'votes16': 704901, 'ev10': 5, 'pres08': 0.423351, 'pres12': 0.44704795, 'rperc': 0.45349205}, {'abbrev': 'va', 'votes16': 3750916, 'ev10': 13, 'pres08': 0.46817416, 'pres12': 0.48032623, 'rperc': 0.47173624}, {'abbrev': 'co', 'votes16': 2541354, 'ev10': 9, 'pres08': 0.45449365, 'pres12': 0.47252012, 'rperc': 0.47316667}, {'abbrev': 'me', 'votes16': 693328, 'ev10': 4, 'pres08': 0.41170475, 'pres12': 0.42140079, 'rperc': 0.48403209}, {'abbrev': 'nv', 'votes16': 1051318, 'ev10': 6, 'pres08': 0.43613262, 'pres12': 0.46592458, 'rperc': 0.48706291}, {'abbrev': 'mn', 'votes16': 2690654, 'ev10': 10, 'pres08': 0.44770625, 'pres12': 0.46058774, 'rperc': 0.49168306}, {'abbrev': 'nh', 'votes16': 694316, 'ev10': 4, 'pres08': 0.45131459, 'pres12': 0.47166248, 'rperc': 0.49802972}, {'abbrev': 'mi', 'votes16': 4548382, 'ev10': 16, 'pres08': 0.41628698, 'pres12': 0.45199468, 'rperc': 0.50117668}, {'abbrev': 'pa', 'votes16': 5897174, 'ev10': 20, 'pres08': 0.44770296, 'pres12': 0.47268066, 'rperc': 0.50375536}, {'abbrev': 'wi', 'votes16': 2787820, 'ev10': 10, 'pres08': 0.42944322, 'pres12': 0.4653657, 'rperc': 0.50407989}, {'abbrev': 'fl', 'votes16': 9122861, 'ev10': 29, 'pres08': 0.4858034, 'pres12': 0.49557748, 'rperc': 0.50618835}, {'abbrev': 'az', 'votes16': 2413568, 'ev10': 11, 'pres08': 0.54313901, 'pres12': 0.5461338, 'rperc': 0.51890023}, {'abbrev': 'nc', 'votes16': 4551947, 'ev10': 15, 'pres08': 0.49834037, 'pres12': 0.51034035, 'rperc': 0.51903746}, {'abbrev': 'ga', 'votes16': 3967067, 'ev10': 16, 'pres08': 0.52628336, 'pres12': 0.53956649, 'rperc': 0.52661173}, {'abbrev': 'oh', 'votes16': 5235169, 'ev10': 18, 'pres08': 0.47666159, 'pres12': 0.48485943, 'rperc': 0.54267685}, {'abbrev': 'tx', 'votes16': 8562915, 'ev10': 38, 'pres08': 0.55935937, 'pres12': 0.58007897, 'rperc': 0.54713226}, {'abbrev': 'ia', 'votes16': 1454652, 'ev10': 6, 'pres08': 0.45151222, 'pres12': 0.47040648, 'rperc': 0.55063548}, {'abbrev': 'sc', 'votes16': 2010762, 'ev10': 9, 'pres08': 0.54544429, 'pres12': 0.55308255, 'rperc': 0.57460256}, {'abbrev': 'ak', 'votes16': 279841, 'ev10': 3, 'pres08': 0.61064785, 'pres12': 0.5731529, 'rperc': 0.58385655}, {'abbrev': 'ms', 'votes16': 1185845, 'ev10': 6, 'pres08': 0.56641931, 'pres12': 0.55801899, 'rperc': 0.59089847}, {'abbrev': 'mo', 'votes16': 2665579, 'ev10': 10, 'pres08': 0.50067579, 'pres12': 0.54778667, 'rperc': 0.59818561}, {'abbrev': 'in', 'votes16': 2590412, 'ev10': 11, 'pres08': 0.49478047, 'pres12': 0.55200375, 'rperc': 0.6011731}, {'abbrev': 'la', 'votes16': 1958792, 'ev10': 8, 'pres08': 0.59457174, 'pres12': 0.58746826, 'rperc': 0.60171677}, {'abbrev': 'mt', 'votes16': 456949, 'ev10': 3, 'pres08': 0.51169403, 'pres12': 0.57034232, 'rperc': 0.61109664}, {'abbrev': 'ks', 'votes16': 1098023, 'ev10': 6, 'pres08': 0.57612276, 'pres12': 0.61113327, 'rperc': 0.6111147}, {'abbrev': 'ut', 'votes16': 825885, 'ev10': 6, 'pres08': 0.64526361, 'pres12': 0.74626189, 'rperc': 0.62382898}, {'abbrev': 'ne', 'votes16': 780455, 'ev10': 5, 'pres08': 0.57609074, 'pres12': 0.6112939, 'rperc': 0.63547674}, {'abbrev': 'tn', 'votes16': 2393620, 'ev10': 11, 'pres08': 0.57631472, 'pres12': 0.60351072, 'rperc': 0.63624343}, {'abbrev': 'ar', 'votes16': 1065366, 'ev10': 6, 'pres08': 0.60171721, 'pres12': 0.62154405, 'rperc': 0.64285138}, {'abbrev': 'al', 'votes16': 2047802, 'ev10': 9, 'pres08': 0.60890903, 'pres12': 0.61216229, 'rperc': 0.64374144}, {'abbrev': 'ky', 'votes16': 1831825, 'ev10': 8, 'pres08': 0.58233428, 'pres12': 0.61542772, 'rperc': 0.65670629}, {'abbrev': 'sd', 'votes16': 345179, 'ev10': 3, 'pres08': 0.54295707, 'pres12': 0.59218499, 'rperc': 0.65971858}, {'abbrev': 'id', 'votes16': 598820, 'ev10': 4, 'pres08': 0.6302459, 'pres12': 0.66421387, 'rperc': 0.68310177}, {'abbrev': 'ok', 'votes16': 1369511, 'ev10': 7, 'pres08': 0.65645081, 'pres12': 0.6677232, 'rperc': 0.69304737}, {'abbrev': 'nd', 'votes16': 310552, 'ev10': 3, 'pres08': 0.54408656, 'pres12': 0.60111208, 'rperc': 0.69809243}, {'abbrev': 'wv', 'votes16': 678165, 'ev10': 5, 'pres08': 0.56673744, 'pres12': 0.63674298, 'rperc': 0.72161052}, {'abbrev': 'wy', 'votes16': 230392, 'ev10': 3, 'pres08': 0.66562023, 'pres12': 0.71160634, 'rperc': 0.7570532}];
		for (var i=0;i<eData.length;i++){
			eData[i].rpred = eData[i].rperc;
			delete eData[i].rperc;
		}
		res.write(nunjucks.render('templates/index.html',{
			electoralData: eData,
		}));
		res.end();
	}
);

app.get(['*'],
	function(req, res){
		

		res.redirect('../');
	}
);



