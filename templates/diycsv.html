<!DOCTYPE html>

	
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Electoral Map</title>
<link rel="icon" type="image/png" href="../img/fav.png">
<meta name="description" content=""/>



  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="css/map.css" rel="stylesheet">
  <link href="css/slider.css" rel="stylesheet">
  <link href="css/tabulator.min.css" rel="stylesheet">
  
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	
<style>
.gridHolder {
	height: 80vh;
	overflow-y:auto;
}
</style>

</head>
<body>

	<div>
		Locations:
		<select id="locations">
			<option value="DC">States+DC</option>
			<option value="MENE">States+DC/ME/NE</option>
			<option value="50">50 States</option>
			<option value="SEN">Senate</option>
		</select>
		<button onclick="updateLocations()">Submit</button>
		<div>
			Add column:
			<input type="text" id="colName"></input>
			<select id="col1">
				<option value="">Type</option>
				{% for first, val in colMap %}
				<option value="{{ first }}">{{ val.displayName }}</option>
				{% endfor %}
			</select>
			<select id="col2">
				<option value="econPresDwin">Economist Pres D win%</option>
				<option value="econPresRwin">Economist Pres R win%</option>
				<option value="econPresDmov">Economist Pres D MOV</option>
				<option value="econPresRmov">Economist Pres R MOV</option>
			</select>
			<select id="col3">
				<option value="2020">2020</option>
				<option value="2016">2016</option>
			</select>
			<button onclick="addColumn()">Submit</button>
		</div>
		
	</div>
	<div class="gridHolder" id="csvTable">

	</div>

  



</body>
<script src="js/tabulator.min.js"></script>
<script>
var tableData = [];

var table = new Tabulator("#csvTable", {
    data:tableData,
    columns:[{'title':'ID','field':'id'}],
});

var colMap = {{ colMap | dump | safe }};
document.getElementById('col1').addEventListener('change',updateOptions2);
document.getElementById('col2').addEventListener('change',updateOptions3);
document.getElementById('col1').addEventListener('input',updateOptions2);
document.getElementById('col2').addEventListener('input',updateOptions3);

function updateOptions2(){
	var col1 = document.getElementById("col1").value;
	var el = document.getElementById("col2");
	el.innerHTML = "";
	for (var i in colMap[col1]){
		if (i == 'displayName'){
			continue;
		}
		var newEl = document.createElement('option');
		newEl.value = i;
		newEl.textContent = colMap[col1][i].displayName;
		el.appendChild(newEl);
	}
}
function updateOptions3(){
	var col1 = document.getElementById("col1").value;
	var col2 = document.getElementById("col2").value;
	var el = document.getElementById("col3");
	el.innerHTML = "";
	for (var i in colMap[col1][col2]){
		if (i == 'displayName'){
			continue;
		}
		var newEl = document.createElement('option');
		newEl.value = i;
		newEl.textContent = colMap[col1][col2][i][2];
		el.appendChild(newEl);
	}
}



var ws = new WebSocket('wss://inlinemath.com:8081');
ws.onopen = function(evt) {
	
}
ws.onmessage = function(evt){
	var allData = JSON.parse(evt.data);
	tableData = allData.tableData;
	
	table.setColumns(allData.columns);
	table.setData(tableData);
}

function updateLocations() {
	var locations = document.getElementById("locations").value;
	var jsonmessage = {'type':'update','locations':locations};
	ws.send(JSON.stringify(jsonmessage));
}
function addColumn() {
	var col1 = document.getElementById("col1").value;
	var col2 = document.getElementById("col2").value;
	var col3 = document.getElementById("col3").value;
	var jsonmessage = {'type':'update','addcolumn':[col1,col2,col3],'name':document.getElementById('colName').value};
	ws.send(JSON.stringify(jsonmessage));
}
</script>


</html>





